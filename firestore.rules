rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Support / Error Registry
    match /erros_suporte/{document=**} {
      allow read, write: if isAuthenticated();
    }

    // Dynamic System Settings (General Registrations)
    match /sys_settings/{document=**} {
      allow read, write: if isAuthenticated();
    }
    
    // Helper function to check if user is logged in
    function isAuthenticated() {
      return request.auth != null;
    }

    // Reports (Flex) - Collaborative
    match /reports/{reportId} {
      allow read, write: if isAuthenticated();
    }

    // Chamados (Tickets) - Collaborative/Support
    match /chamados/{ticketId} {
      allow read, write: if isAuthenticated();
      
      match /interacoes/{interactionId} {
        allow read, write: if isAuthenticated();
      }
    }

    // Support Tickets (Bugs/Features)
    match /suporte_tickets/{ticketId} {
      allow read, write: if isAuthenticated();
    }

    // Kanban - Personal but currently open to all auth users to avoid permission errors
    match /kanban_tarefas/{taskId} {
      allow read, write: if isAuthenticated();
    }
    
    match /kanban_todo/{todoId} {
      allow read, write: if isAuthenticated();
    }

    // Users - Protected (Users can only edit their own profile)
    match /usuarios/{userId} {
      allow read: if isAuthenticated();
      allow write: if request.auth.uid == userId;
    }
  }
}
