import{h as ee,r as n,j as e,Q as x}from"./index-YcD-ttPr.js";import{a as te}from"./ideris-DaLYvt-j.js";import{S as re,R as se,P as ae,H as Q}from"./html5-qrcode-scanner-B3phz4Go.js";import{C as ne}from"./ConfirmationModal-B558a7Nf.js";import{C as A}from"./check-circle-CmV0t6ZD.js";import{c as I}from"./createLucideIcon-2-TjKtBl.js";import{S as oe}from"./search-DdAf8kdi.js";import{X as le}from"./x-LSnkibjN.js";import{S as ce}from"./scan-barcode-CBDG-l_l.js";import{T as E}from"./trash-2-DbcUHzGu.js";import"./alert-triangle--JnSiDDj.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=I("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=I("WifiOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 4.17-2.65",key:"11utq1"}],["path",{d:"M10.66 5c4.01-.36 8.14.9 11.34 3.76",key:"hxefdu"}],["path",{d:"M16.85 11.25a10 10 0 0 1 2.22 1.68",key:"q734kn"}],["path",{d:"M5 13a10 10 0 0 1 5.24-2.76",key:"piq4yl"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=I("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);function we(){const{iderisSettings:u}=ee(),[w,v]=n.useState(""),[D,M]=n.useState(!1),[R,V]=n.useState(!(u!=null&&u.enabled)),[l,h]=n.useState([]),[p,b]=n.useState(null),[m,C]=n.useState(!1),[g,W]=n.useState([]),[$,U]=n.useState(null);n.useRef(null);const i=n.useRef(null),j=n.useRef(null),S=n.useRef(!1),[N,k]=n.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{},variant:"danger"}),O=n.useRef(l);n.useEffect(()=>{O.current=l},[l]),n.useEffect(()=>{u&&!u.enabled&&V(!0)},[u]),n.useEffect(()=>{var t;return m||(t=j.current)==null||t.focus(),()=>{}},[m]),n.useEffect(()=>()=>{i.current&&(i.current.stop().catch(t=>console.error("Error stopping scanner:",t)),i.current=null)},[]);const y=t=>{const r=new(window.AudioContext||window.webkitAudioContext),s=r.createOscillator(),a=r.createGain();s.connect(a),a.connect(r.destination),t==="success"?(s.type="sine",s.frequency.setValueAtTime(800,r.currentTime),s.frequency.exponentialRampToValueAtTime(1200,r.currentTime+.1),a.gain.setValueAtTime(.1,r.currentTime),a.gain.exponentialRampToValueAtTime(.01,r.currentTime+.1),s.start(),s.stop(r.currentTime+.1)):t==="error"&&(s.type="sawtooth",s.frequency.setValueAtTime(200,r.currentTime),s.frequency.linearRampToValueAtTime(100,r.currentTime+.2),a.gain.setValueAtTime(.2,r.currentTime),a.gain.exponentialRampToValueAtTime(.01,r.currentTime+.2),s.start(),s.stop(r.currentTime+.2))},P=async(t,r=null)=>{var f,H,F;t&&t.preventDefault();const s=r||w.trim(),a=()=>{v(""),m||setTimeout(()=>{var o;return(o=j.current)==null?void 0:o.focus()},100)};if(!s)return a(),"empty";if(O.current.some(o=>o.code===s)){const o={code:s,status:"DUPLICADO",type:"error",timestamp:new Date,img:null};return b(o),h(d=>[o,...d]),x.warn(`Código ${s} já foi verificado!`),y("error"),a(),"duplicate"}if(R){const o={code:s,status:"Conferido",type:"success",timestamp:new Date,img:null};return b(o),h(d=>[o,...d]),x.success(`Código ${s} conferido.`),y("success"),a(),"success"}M(!0);try{const o=await te(s),d=o.statusDescription||o.status||"Encontrado",T=d.toLowerCase().includes("cancelado")||d.toLowerCase().includes("erro"),G={code:s,status:d,type:T?"error":"success",timestamp:new Date,customer:(f=o.customer)==null?void 0:f.name,img:(F=(H=o.items)==null?void 0:H[0])==null?void 0:F.image};return b(G),h(Z=>[G,...Z]),T?(x.error(`Pedido ${s}: ${d}`),y("error"),"error"):(x.success(`Pedido ${s} verificado!`),y("success"),"success")}catch(o){const d={code:s,status:"Não encontrado / Erro",type:"error",timestamp:new Date,img:null};return b(d),h(T=>[d,...T]),x.error(o.message),y("error"),"error"}finally{M(!1),a()}},q=t=>{k({isOpen:!0,title:"Remover Item",message:"Deseja remover este item da lista de verificação?",variant:"danger",onConfirm:()=>{h(r=>{const s=r.filter((a,c)=>c!==t);return s.length===0&&b(null),s}),x.info("Item removido.")}})},_=()=>{k({isOpen:!0,title:"Limpar Histórico",message:"Tem certeza que deseja limpar todo o histórico de verificação? Esta ação não pode ser desfeita.",variant:"danger",onConfirm:()=>{h([]),b(null),v(""),x.info("Histórico limpo."),setTimeout(()=>{var t;return(t=j.current)==null?void 0:t.focus()},100)}})},z=async()=>{if(m&&L(),C(!0),await new Promise(r=>setTimeout(r,400)),!document.getElementById("reader-verification")){console.error("Reader element not found"),C(!1);return}try{const r=await Q.getCameras();W(r);const s=new Q("reader-verification");i.current=s;const a={fps:20,qrbox:{width:300,height:300},aspectRatio:1},c=$||{facingMode:"environment"};await s.start(c,a,async f=>{if(!S.current){S.current=!0,y("success");try{await P(null,f)}finally{setTimeout(()=>{S.current=!1},1500)}}},f=>{})}catch(r){console.error("Erro ao iniciar scanner:",r),x.error("Não foi possível acessar a câmera."),C(!1)}},J=async()=>{if(!i.current||g.length<2)return;const r=(g.findIndex(a=>a.id===$)+1)%g.length,s=g[r].id;try{L(),U(s),setTimeout(()=>z(),100),x.info(`Câmera alterada para: ${g[r].label||"Próxima"}`)}catch(a){console.error("Erro ao trocar câmera:",a),x.error("Erro ao trocar de câmera.")}},L=()=>{const t=()=>{C(!1),setTimeout(()=>{var r;return(r=j.current)==null?void 0:r.focus()},100)};i.current?i.current.stop().then(()=>{i.current=null,t()}).catch(r=>{console.error("Erro ao parar scanner:",r),t()}):t()};n.useEffect(()=>()=>{i.current&&(i.current.stop().catch(t=>console.error(t)),i.current=null)},[]);const K=()=>{m?L():z()},Y=()=>{window.print()},B=l.reduce((t,r)=>(t[r.code]=(t[r.code]||0)+1,t),{});return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 pb-20",children:[e.jsxs("div",{className:"print:hidden space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 bg-white p-4 rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(A,{className:"w-8 h-8 text-blue-600"}),"Verificação"]}),(u==null?void 0:u.enabled)&&e.jsx("div",{className:"flex items-center gap-4 bg-gray-50 px-4 py-2 rounded-lg border border-gray-200",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:!R,onChange:t=>V(!t.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"}),e.jsx("span",{className:"ml-3 text-sm font-bold text-gray-700 flex items-center gap-2",children:R?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-4 h-4 text-gray-500"}),"Modo Local"]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4 text-blue-600"}),"Ideris API"]})})]})})})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("form",{onSubmit:P,className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{ref:j,type:"text",value:w,onChange:t=>v(t.target.value),placeholder:"Bipe ou digite o código...",className:"w-full pl-10 pr-10 py-2 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",autoFocus:!0}),w&&e.jsx("button",{type:"button",onClick:()=>v(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 p-1",children:e.jsx(le,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",disabled:D||!w.trim(),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium shadow-sm hover:shadow transition-all disabled:opacity-70 flex-1 md:flex-none",children:D?e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full"}):"Verificar"}),e.jsx("button",{type:"button",onClick:K,className:`p-3 rounded-lg border transition-colors ${m?"bg-red-50 border-red-200 text-red-600 animate-pulse":"bg-white border-gray-300 text-gray-600 hover:bg-gray-50"}`,title:m?"Parar Scanner":"Abrir Câmera",children:m?e.jsx(re,{size:20}):e.jsx(ce,{size:20})}),m&&g.length>1&&e.jsx("button",{type:"button",onClick:J,className:"p-3 rounded-lg border bg-blue-50 border-blue-200 text-blue-600 hover:bg-blue-100 transition-colors",title:"Alternar Câmera",children:e.jsx(se,{size:20})})]})]}),m&&e.jsxs("div",{className:"mt-4 overflow-hidden rounded-xl bg-black relative",style:{minHeight:"300px"},children:[e.jsx("div",{id:"reader-verification",className:"w-full h-full"}),e.jsx("p",{className:"text-center text-white py-2 text-sm bg-black font-semibold absolute bottom-0 left-0 w-full opacity-70 border-t border-white/20",children:"Escaneando..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsxs("button",{onClick:Y,className:"text-gray-600 hover:bg-gray-100 px-4 py-2 rounded-lg font-medium flex items-center gap-2 transition-colors",children:[e.jsx(ae,{className:"w-4 h-4"})," Imprimir Lista"]}),e.jsxs("button",{onClick:_,className:"text-red-600 hover:bg-red-50 px-4 py-2 rounded-lg font-medium flex items-center gap-2 transition-colors",children:[e.jsx(E,{className:"w-4 h-4"})," Limpar Tudo"]})]})]}),p&&e.jsx("div",{className:`rounded-xl shadow-lg border-l-8 p-6 animate-fade-in ${p.type==="success"?"bg-green-50 border-green-500":"bg-red-50 border-red-500"}`,children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-6",children:[e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("p",{className:"text-sm font-bold opacity-60 uppercase mb-1",children:"Última Verificação"}),e.jsx("h2",{className:"text-4xl font-black tracking-tight text-gray-900",children:p.code}),e.jsx("p",{className:`text-2xl font-bold mt-2 ${p.type==="success"?"text-green-700":"text-red-600"}`,children:p.status}),p.customer&&e.jsx("p",{className:"text-gray-600 mt-1 font-medium",children:p.customer})]}),e.jsx("div",{className:"flex items-center gap-4",children:p.type==="success"?e.jsx(A,{className:"w-24 h-24 text-green-500 opacity-20"}):e.jsx(X,{className:"w-24 h-24 text-red-500 opacity-20"})})]})}),l.length>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden print-visible",children:[e.jsx("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50",children:e.jsxs("h3",{className:"font-bold text-gray-700",children:["Histórico (",l.length,")"]})}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full border-separate border-spacing-0",children:[e.jsx("thead",{className:"bg-gray-100 border-b-2 border-slate-200 text-xs uppercase text-gray-600 font-bold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left w-20 border-r border-white",children:"#"}),e.jsx("th",{className:"px-6 py-4 text-left border-r border-white",children:"Hora"}),e.jsx("th",{className:"px-6 py-4 text-left border-r border-white",children:"Código"}),e.jsx("th",{className:"px-6 py-4 text-left border-r border-white",children:"Cliente"}),e.jsx("th",{className:"px-6 py-4 text-left border-r border-white",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:l.map((t,r)=>{const s=B[t.code]>1,a=l.length-r;let c="hover:bg-gray-50";t.type==="error"&&(c+=" bg-red-50 hover:bg-red-100");const f=s?"border-l-4 border-red-500":"border-l-4 border-transparent";return e.jsxs("tr",{className:c,children:[e.jsxs("td",{className:`px-6 py-3 text-sm font-bold text-gray-400 w-16 ${f}`,children:["#",a]}),e.jsx("td",{className:"px-6 py-3 text-sm text-gray-500",children:t.timestamp.toLocaleTimeString("pt-BR")}),e.jsx("td",{className:"px-6 py-3 font-bold text-gray-900",children:t.code}),e.jsx("td",{className:"px-6 py-3 text-sm text-gray-600",children:t.customer||"-"}),e.jsx("td",{className:"px-6 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold uppercase ${t.type==="success"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-3 text-right",children:e.jsx("button",{onClick:()=>q(r),className:"text-gray-400 hover:text-red-500 p-2 rounded transition-colors",title:"Remover item",children:e.jsx(E,{className:"w-4 h-4"})})})]},r)})})]})}),e.jsx("div",{className:"md:hidden divide-y divide-gray-200",children:l.map((t,r)=>{const s=B[t.code]>1,a=l.length-r;let c="p-4 transition-colors duration-150 relative";return t.type==="error"?c+=" bg-red-50":c+=" bg-white",s&&(c+=" border-l-4 border-red-500"),e.jsx("div",{className:c,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"text-xs font-bold text-gray-400",children:["#",a]}),e.jsx("span",{className:"text-xs font-mono text-gray-500 bg-gray-100 px-2 py-1 rounded",children:t.timestamp.toLocaleTimeString("pt-BR")}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold uppercase ${t.type==="success"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:t.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold text-gray-900 break-all",children:t.code}),t.customer&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-1",children:t.customer})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-3 ml-4",children:[e.jsx("button",{onClick:()=>q(r),className:"text-gray-400 hover:text-red-500 p-1",children:e.jsx(E,{className:"w-5 h-5"})}),t.type==="success"?e.jsx(A,{className:"w-6 h-6 text-green-500"}):e.jsx(X,{className:"w-6 h-6 text-red-500"})]})]})},r)})})]})]}),e.jsxs("div",{className:"hidden print:block p-8 bg-white text-black bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b-2 border-black pb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold uppercase tracking-wide",children:"Relatório de Conferência"}),e.jsxs("p",{className:"text-lg mt-1",children:[new Date().toLocaleDateString("pt-BR")," - ",new Date().toLocaleTimeString("pt-BR")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Total de Itens"}),e.jsx("p",{className:"text-4xl font-black",children:l.length})]})]}),e.jsxs("table",{className:"w-full text-sm border-collapse mb-8",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-black",children:[e.jsx("th",{className:"text-left py-2 px-3 font-bold uppercase w-16",children:"#"}),e.jsx("th",{className:"text-left py-2 px-3 font-bold uppercase w-32",children:"Hora"}),e.jsx("th",{className:"text-left py-2 px-3 font-bold uppercase",children:"Código"}),e.jsx("th",{className:"text-left py-2 px-3 font-bold uppercase w-40",children:"Status"})]})}),e.jsx("tbody",{children:[...l].reverse().map((t,r)=>e.jsxs("tr",{className:`border-b border-gray-300 ${r%2===0?"bg-gray-100":"bg-white"}`,children:[e.jsx("td",{className:"py-3 px-3 text-gray-700",children:r+1}),e.jsx("td",{className:"py-3 px-3 font-mono",children:t.timestamp.toLocaleTimeString("pt-BR")}),e.jsx("td",{className:"py-3 px-3 font-bold text-lg",children:t.code}),e.jsx("td",{className:"py-3 px-3 uppercase font-medium",children:t.status})]},r))})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center mt-20 pt-10",children:[e.jsx("div",{className:"w-96 border-b-2 border-black mb-3"}),e.jsx("p",{className:"text-sm uppercase font-bold tracking-wider",children:"Assinatura do Responsável"})]})]}),e.jsx(ne,{isOpen:N.isOpen,onClose:()=>k(t=>({...t,isOpen:!1})),onConfirm:()=>{N.onConfirm(),k(t=>({...t,isOpen:!1}))},title:N.title,message:N.message,variant:N.variant})]})}export{we as default};
