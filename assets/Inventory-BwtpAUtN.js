import{h as P,u as z,r,Q as o,j as e}from"./index-YcD-ttPr.js";import{s as A,u as q}from"./ideris-DaLYvt-j.js";import{C as K}from"./ConfirmationModal-B558a7Nf.js";import{P as M}from"./package-CmT3i10U.js";import{S as O}from"./search-DdAf8kdi.js";import{X as $}from"./x-LSnkibjN.js";import{T as D}from"./trash-2-DbcUHzGu.js";import{S as B}from"./save-BrK1XgPG.js";import"./alert-triangle--JnSiDDj.js";import"./createLucideIcon-2-TjKtBl.js";function Y(){const{iderisSettings:b}=P(),N=z(),[n,x]=r.useState(""),[i,h]=r.useState([]),[f,w]=r.useState(!1),[S,k]=r.useState(!1),[C,y]=r.useState(""),[d,v]=r.useState({});r.useEffect(()=>{b&&!b.enabled&&(o.warning("O Módulo de Integração (Ideris) está desabilitado"),N("/"))},[b,N]);const[c,p]=r.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{},variant:"danger"});r.useEffect(()=>{const t=localStorage.getItem("inventoryLastSearch"),a=localStorage.getItem("inventoryProducts");if(t&&(x(t),y(t)),a)try{h(JSON.parse(a))}catch(s){console.error("Erro ao carregar produtos salvos",s)}},[]);const U=async t=>{if(t.preventDefault(),!n.trim())return;const a=n.split(",").map(s=>s.trim()).filter(Boolean);if(a.length!==0){w(!0);try{const s=await A(a);s.sort((l,g)=>String(l.sku).localeCompare(String(g.sku),void 0,{numeric:!0,sensitivity:"base"})),h(s),y(n),localStorage.setItem("inventoryLastSearch",n),localStorage.setItem("inventoryProducts",JSON.stringify(s)),s.length===0?o.info("Nenhum produto encontrado para os SKUs informados."):o.success(`${s.length} produto(s) encontrado(s).`)}catch(s){o.error("Erro ao buscar SKUs."),console.error(s)}finally{w(!1)}}},E=()=>{p({isOpen:!0,title:"Limpar Lista",message:"Deseja limpar todos os produtos e resultados da pesquisa atual?",variant:"danger",onConfirm:()=>{h([]),x(""),y(""),v({}),localStorage.removeItem("inventoryLastSearch"),localStorage.removeItem("inventoryProducts"),o.info("Lista limpa.")}})},I=(t,a)=>{v(s=>({...s,[t]:a}))},L=async()=>{const t=Object.keys(d).filter(a=>{const s=d[a];return s!=null&&String(s).trim()!==""&&!isNaN(Number(s))});if(t.length===0){o.warn("Nenhum item com novo estoque válido para atualizar.");return}p({isOpen:!0,title:"Atualizar Estoque",message:`Deseja atualizar o estoque de ${t.length} item(ns)? Esta ação alterará os valores no Ideris.`,variant:"info",onConfirm:async()=>{k(!0);let a=0,s=0;for(const l of t){const g=parseInt(d[l],10);try{await q(l,g),h(u=>{const m=u.map(j=>j.sku===l?{...j,stockAmount:g}:j);return localStorage.setItem("inventoryProducts",JSON.stringify(m)),m}),v(u=>{const m={...u};return delete m[l],m}),a++}catch(u){console.error(`Falha ao atualizar SKU ${l}:`,u),s++}}a>0&&o.success(`${a} SKU(s) atualizados com sucesso!`),s>0&&o.error(`${s} falha(s) na atualização.`),k(!1)}})};return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(M,{className:"w-8 h-8 text-blue-600"}),"Gestão de Estoque"]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("form",{onSubmit:U,className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",value:n,onChange:t=>x(t.target.value),placeholder:"Digite os SKUs separados por vírgula (ex: 235, 101, 50)",className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all"}),n&&e.jsx("button",{type:"button",onClick:()=>x(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 p-1",children:e.jsx($,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[e.jsxs("button",{type:"submit",disabled:f||!n.trim(),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium shadow-sm hover:shadow transition-all flex items-center justify-center gap-2 disabled:opacity-70 disabled:shadow-none",children:[f?e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full"}):e.jsx(O,{className:"w-5 h-5"}),"Buscar"]}),e.jsxs("button",{type:"button",onClick:E,className:"bg-gray-100 hover:bg-gray-200 text-gray-800 px-4 py-2 rounded-lg font-medium shadow-sm hover:shadow transition-all flex items-center justify-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"Limpar"]}),e.jsxs("button",{type:"button",onClick:L,disabled:S||i.length===0,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium shadow-sm hover:shadow transition-all flex items-center justify-center gap-2 disabled:opacity-70 disabled:shadow-none",children:[S?e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full"}):e.jsx(B,{className:"w-5 h-5"}),"Atualizar"]})]})]}),C&&e.jsxs("div",{className:"mt-4 text-center text-sm text-gray-500",children:[e.jsxs("p",{children:["Última pesquisa: ",C]}),!f&&e.jsx("p",{className:"mt-1 text-green-600 font-medium",children:"Consulta concluída."})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100 border-b-2 border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-600 border-r border-white",children:"SKU"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-600 border-r border-white",children:"Produto"}),e.jsx("th",{className:"px-6 py-4 text-center text-sm font-semibold text-gray-600 border-r border-white",children:"Estoque Atual"}),e.jsx("th",{className:"px-6 py-4 text-center text-sm font-semibold text-gray-600",children:"Atualizar"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-8 text-center text-gray-500",children:"Nenhum produto listado."})}):i.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-blue-700 font-bold font-mono text-base bg-blue-50 px-2 py-1 rounded border border-blue-100",children:t.sku})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-gray-800 font-medium",title:t.title||t.nome,children:t.title||t.nome})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("span",{className:"inline-flex items-center justify-center px-3 py-1 rounded-full bg-blue-50 text-blue-700 font-bold text-sm border border-blue-100",children:t.stockAmount})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("input",{type:"number",min:"0",placeholder:"Novo",value:d[t.sku]||"",onChange:a=>I(t.sku,a.target.value),className:"w-24 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-center transition-all hover:border-blue-400"})})]},t.id))})]})}),e.jsx("div",{className:"md:hidden space-y-4 p-4 min-h-screen bg-transparent",children:i.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500 bg-white rounded-xl shadow-sm border border-gray-200",children:"Nenhum produto listado."}):i.map(t=>e.jsx("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden transition-all duration-200 hover:shadow-lg",children:e.jsxs("div",{className:"p-5",children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsx("span",{className:"text-xl font-bold text-blue-700 bg-blue-50 px-3 py-1.5 rounded-lg border border-blue-100 font-mono",children:t.sku})}),e.jsx("h3",{className:"font-bold text-gray-900 leading-relaxed text-lg mb-4",children:t.title||t.nome}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded-xl border border-gray-200 text-center flex flex-col justify-center",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase font-bold tracking-wider mb-1",children:"Atual"}),e.jsx("p",{className:"text-2xl font-black text-gray-800",children:t.stockAmount})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-xl border border-blue-100 text-center flex flex-col justify-center relative",children:[e.jsx("p",{className:"text-xs text-blue-500 uppercase font-bold tracking-wider mb-1",children:"Novo"}),e.jsx("input",{type:"number",inputMode:"numeric",pattern:"[0-9]*",placeholder:"-",value:d[t.sku]||"",onChange:a=>I(t.sku,a.target.value),className:"w-full text-center text-2xl font-black text-blue-600 outline-none bg-transparent placeholder-blue-300 z-10"})]})]})]})},t.id))})]}),e.jsx(K,{isOpen:c.isOpen,onClose:()=>p(t=>({...t,isOpen:!1})),onConfirm:()=>{c.onConfirm(),p(t=>({...t,isOpen:!1}))},title:c.title,message:c.message,variant:c.variant})]})}export{Y as default};
