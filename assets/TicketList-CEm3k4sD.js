import{r as t,u as M,q as B,m as $,k as O,o as q,j as e,a as R,d as z,g as V}from"./index-CagITQnK.js";import{P as X}from"./plus-DnilBAXT.js";import{S as _}from"./search-DYSXYbPs.js";import{X as G}from"./x-Cd0rxfxV.js";import{c as H}from"./createLucideIcon-o0tCEqv0.js";import{P as k}from"./paperclip-noycIzRv.js";import{E as J}from"./eye-CrLlkqVP.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=H("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);function te(){const[x,A]=t.useState([]),[g,f]=t.useState(!0),[o,h]=t.useState(localStorage.getItem("ticketSearchTerm")||""),[l,j]=t.useState(localStorage.getItem("ticketStatusFilter")||"Todos"),m=M();t.useEffect(()=>{const s=B(O(R,"chamados"),$("dataAbertura","desc")),a=q(s,r=>{const d=r.docs.map(p=>({id:p.id,...p.data()}));A(d),f(!1)},r=>{console.error("Erro ao buscar chamados:",r),r.code==="permission-denied"&&f(!1)});return()=>a()},[]);const[E,y]=t.useState([]),[P,b]=t.useState([]);t.useEffect(()=>{(async()=>{try{const a=z(R,"sys_settings","general"),r=await V(a);if(r.exists()){const d=r.data();y(d.ticketTypes||[]),b(d.marketplaces||[])}else y(["Devolução","Reembolso","Fraude","Contatar MarketPlace","Contatar Cliente","Interno","Defeito","Prejuízo","Atraso na entrega","Produto errado","Faltou item","Dúvida técnica","Cancelamento"]),b(["Mercado Livre","Amazon","Interno","Shopee","Magalu"])}catch(a){console.error("Error fetching settings:",a)}})()},[]);const[n,v]=t.useState(localStorage.getItem("ticketTypeFilter")||"Todos"),[c,N]=t.useState(localStorage.getItem("ticketMarketplaceFilter")||"Todos"),[i,w]=t.useState(localStorage.getItem("ticketResponsibleFilter")||"Todos");t.useEffect(()=>{localStorage.setItem("ticketSearchTerm",o)},[o]),t.useEffect(()=>{localStorage.setItem("ticketStatusFilter",l)},[l]),t.useEffect(()=>{localStorage.setItem("ticketTypeFilter",n)},[n]),t.useEffect(()=>{localStorage.setItem("ticketMarketplaceFilter",c)},[c]),t.useEffect(()=>{localStorage.setItem("ticketResponsibleFilter",i)},[i]);const I=()=>{h(""),j("Todos"),v("Todos"),N("Todos"),w("Todos")},u=x.filter(s=>{var T,C,F,L;const a=((T=s.codigo)==null?void 0:T.toLowerCase().includes(o.toLowerCase()))||((C=s.assunto)==null?void 0:C.toLowerCase().includes(o.toLowerCase()))||((F=s.responsavel)==null?void 0:F.toLowerCase().includes(o.toLowerCase()))||((L=s.pedido)==null?void 0:L.toLowerCase().includes(o.toLowerCase())),r=l==="Todos"||s.status===l,d=n==="Todos"||s.tipo===n,p=c==="Todos"||s.marketplace===c,D=i==="Todos"||s.responsavel===i;return a&&r&&d&&p&&D}),S=s=>{switch(s){case"Aberto":return"bg-blue-100 text-blue-800";case"Pendente":return"bg-yellow-100 text-yellow-800";case"Revisão":return"bg-purple-100 text-purple-800";case"Fechado":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Chamados"}),e.jsxs("div",{className:"flex gap-4 mt-1 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})," Abertos: ",x.filter(s=>s.status==="Aberto").length]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-yellow-500"})," Pendentes: ",x.filter(s=>s.status==="Pendente").length]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500"})," Em Revisão: ",x.filter(s=>s.status==="Revisão").length]})]})]}),e.jsxs("button",{onClick:()=>m("/chamados/novo"),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors",children:[e.jsx(X,{className:"w-5 h-5"}),"Novo Chamado"]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Buscar por código, assunto ou responsável...",value:o,onChange:s=>h(s.target.value),className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"}),o&&e.jsx("button",{onClick:()=>h(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 p-1",children:e.jsx(G,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mt-4 lg:mt-0",children:[e.jsxs("div",{className:"flex items-center gap-1 group",children:[e.jsx(K,{className:"text-gray-400 w-5 h-5 hidden sm:block"}),(l!=="Todos"||n!=="Todos"||c!=="Todos"||i!=="Todos")&&e.jsx("button",{onClick:I,className:"text-xs text-red-500 hover:text-red-700 font-medium",title:"Limpar todos os filtros",children:"Limpar"})]}),e.jsxs("select",{value:l,onChange:s=>j(s.target.value),className:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-2 focus:ring-blue-500 outline-none text-sm",children:[e.jsx("option",{value:"Todos",children:"Todos os Status"}),e.jsx("option",{value:"Aberto",children:"Aberto"}),e.jsx("option",{value:"Pendente",children:"Pendente"}),e.jsx("option",{value:"Revisão",children:"Revisão"}),e.jsx("option",{value:"Fechado",children:"Fechado"})]}),e.jsxs("select",{value:n,onChange:s=>v(s.target.value),className:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-2 focus:ring-blue-500 outline-none text-sm",children:[e.jsx("option",{value:"Todos",children:"Todos os Tipos"}),E.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:c,onChange:s=>N(s.target.value),className:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-2 focus:ring-blue-500 outline-none text-sm",children:[e.jsx("option",{value:"Todos",children:"Todos os Marketplaces"}),P.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:i,onChange:s=>w(s.target.value),className:"border border-gray-300 rounded-lg px-2 py-2 focus:ring-2 focus:ring-blue-500 outline-none text-sm",children:[e.jsx("option",{value:"Todos",children:"Todos os Responsáveis"}),[...new Set(x.map(s=>s.responsavel).filter(Boolean))].sort().map(s=>e.jsx("option",{value:s,children:s},s))]})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Código"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assunto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Responsável"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:g?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-10 text-center text-gray-500",children:e.jsxs("div",{className:"flex justify-center items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),"Carregando chamados..."]})})}):u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-10 text-center text-gray-500",children:"Nenhum chamado encontrado."})}):u.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>m(`/chamados/${s.id}`),children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap font-medium text-blue-600",children:s.codigo}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900 font-medium",children:s.assunto}),e.jsx("div",{className:"text-xs text-gray-500",children:s.tipo})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold text-gray-600",children:s.responsavel?s.responsavel.charAt(0):"?"}),e.jsx("span",{className:"text-sm text-gray-700",children:s.responsavel||"Não atribuído"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${S(s.status)}`,children:s.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(s.dataAbertura).toLocaleDateString("pt-BR")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[s.anexos&&s.anexos.length>0&&e.jsx(k,{className:"w-4 h-4 text-gray-400",title:"Possui anexos"}),e.jsx("button",{onClick:a=>{a.stopPropagation(),m(`/chamados/${s.id}`)},className:"text-blue-600 hover:text-blue-900",title:"Ver Detalhes",children:e.jsx(J,{className:"w-5 h-5"})})]})})]},s.id))})]})}),e.jsx("div",{className:"md:hidden",children:g?e.jsx("div",{className:"p-10 text-center text-gray-500",children:e.jsxs("div",{className:"flex justify-center items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),"Carregando chamados..."]})}):u.length===0?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Nenhum chamado encontrado."}):e.jsx("div",{className:"divide-y divide-gray-200",children:u.map(s=>e.jsxs("div",{className:"p-4 hover:bg-gray-50 active:bg-gray-100 cursor-pointer",onClick:()=>m(`/chamados/${s.id}`),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-blue-600 text-sm block",children:s.codigo}),e.jsxs("h3",{className:"text-gray-900 font-medium flex items-center gap-2",children:[s.assunto,s.anexos&&s.anexos.length>0&&e.jsx(k,{className:"w-4 h-4 text-gray-400"})]})]}),e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${S(s.status)}`,children:s.status})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-500 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold text-gray-600",children:s.responsavel?s.responsavel.charAt(0):"?"}),e.jsx("span",{children:s.responsavel||"Não atribuído"})]}),e.jsx("span",{children:new Date(s.dataAbertura).toLocaleDateString("pt-BR")})]})]},s.id))})})]})]})}export{te as default};
