import{r as i,j as e,Q as x}from"./index-Dxq4BH_x.js";import{g as F}from"./ideris-SjOkkJh4.js";import{S as G,P as U,H as q,a as N}from"./html5-qrcode-scanner-BNHjf4el.js";import{C as T}from"./check-circle-BKsONDGp.js";import{c as R}from"./createLucideIcon-n6XUj5cu.js";import{S as W}from"./search-DRNu95VL.js";import{S as X}from"./scan-barcode-CuIijAbQ.js";import{T as S}from"./trash-2-CUbZOxNU.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=R("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=R("WifiOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 4.17-2.65",key:"11utq1"}],["path",{d:"M10.66 5c4.01-.36 8.14.9 11.34 3.76",key:"hxefdu"}],["path",{d:"M16.85 11.25a10 10 0 0 1 2.22 1.68",key:"q734kn"}],["path",{d:"M5 13a10 10 0 0 1 5.24-2.76",key:"piq4yl"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=R("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);function le(){const[w,h]=i.useState(""),[A,L]=i.useState(!1),[v,B]=i.useState(!1),[d,u]=i.useState([]),[m,f]=i.useState(null),[n,k]=i.useState(!1),p=i.useRef(null),g=i.useRef(null);i.useEffect(()=>{var t;return n||(t=g.current)==null||t.focus(),()=>{p.current}},[n]),i.useEffect(()=>()=>{p.current&&p.current.stop().catch(t=>console.warn("Scanner cleanup",t))},[]);const b=t=>{const s=new(window.AudioContext||window.webkitAudioContext),r=s.createOscillator(),a=s.createGain();r.connect(a),a.connect(s.destination),t==="success"?(r.type="sine",r.frequency.setValueAtTime(800,s.currentTime),r.frequency.exponentialRampToValueAtTime(1200,s.currentTime+.1),a.gain.setValueAtTime(.1,s.currentTime),a.gain.exponentialRampToValueAtTime(.01,s.currentTime+.1),r.start(),r.stop(s.currentTime+.1)):t==="error"&&(r.type="sawtooth",r.frequency.setValueAtTime(200,s.currentTime),r.frequency.linearRampToValueAtTime(100,s.currentTime+.2),a.gain.setValueAtTime(.2,s.currentTime),a.gain.exponentialRampToValueAtTime(.01,s.currentTime+.2),r.start(),r.stop(s.currentTime+.2))},D=async(t,s=null)=>{var l,y,$;t&&t.preventDefault();const r=s||w.trim();if(!r)return"empty";if(d.some(c=>c.code===r)){const c={code:r,status:"DUPLICADO",type:"error",timestamp:new Date,img:null};return f(c),u(o=>[c,...o]),x.warn(`Código ${r} já foi verificado!`),b("error"),h(""),"duplicate"}if(v){const c={code:r,status:"Conferido",type:"success",timestamp:new Date,img:null};return f(c),u(o=>[c,...o]),x.success(`Código ${r} conferido.`),b("success"),h(""),"success"}L(!0);try{const c=await F(r),o=c.statusDescription||c.status||"Encontrado",j=o.toLowerCase().includes("cancelado")||o.toLowerCase().includes("erro"),M={code:r,status:o,type:j?"error":"success",timestamp:new Date,customer:(l=c.customer)==null?void 0:l.name,img:($=(y=c.items)==null?void 0:y[0])==null?void 0:$.image};return f(M),u(z=>[M,...z]),j?(x.error(`Pedido ${r}: ${o}`),b("error"),"error"):(x.success(`Pedido ${r} verificado!`),b("success"),"success")}catch(c){const o={code:r,status:"Não encontrado / Erro",type:"error",timestamp:new Date,img:null};return f(o),u(j=>[o,...j]),x.error(c.message),b("error"),"error"}finally{L(!1),h(""),n||setTimeout(()=>{var c;(c=g.current)==null||c.focus()},100)}},I=t=>{window.confirm("Remover este item da lista?")&&(u(s=>s.filter((r,a)=>a!==t)),x.info("Item removido."))},H=()=>{var t;window.confirm("Tem certeza que deseja limpar todo o histórico de verificação?")&&(u([]),f(null),h(""),x.info("Histórico limpo."),(t=g.current)==null||t.focus())},C=i.useRef(!1),O=async()=>{if(!n)try{p.current=new q("verification-reader");const t=await q.getCameras();if(t&&t.length){let s=t[0].deviceId;const r=t.find(a=>a.label.toLowerCase().includes("back")||a.label.toLowerCase().includes("traseira"));r&&(s=r.deviceId),await p.current.start(s,{fps:10,qrbox:{width:250,height:100},formatsToSupport:[N.CODE_128,N.EAN_13,N.UPC_A,N.QR_CODE]},a=>{C.current||(C.current=!0,setTimeout(()=>{C.current=!1},2e3),D(null,a).then(l=>{(l==="error"||l==="duplicate")&&V()}))},a=>{}),k(!0)}else x.error("Nenhuma câmera encontrada.")}catch(t){console.error("Erro no scanner:",t),x.error("Erro ao iniciar scanner."),k(!1)}},V=async()=>{if(p.current&&n)try{await p.current.stop(),k(!1)}catch(t){console.error("Erro ao parar scanner:",t)}},Q=()=>{n?V():O()},_=()=>{window.print()},E=d.reduce((t,s)=>(t[s.code]=(t[s.code]||0)+1,t),{});return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 pb-20",children:[e.jsxs("div",{className:"print:hidden space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 bg-white p-4 rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(T,{className:"w-8 h-8 text-blue-600"}),"Verificação"]}),e.jsx("div",{className:"flex items-center gap-4 bg-gray-50 px-4 py-2 rounded-lg border border-gray-200",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:!v,onChange:t=>B(!t.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"}),e.jsx("span",{className:"ml-3 text-sm font-bold text-gray-700 flex items-center gap-2",children:v?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4 text-gray-500"}),"Modo Local"]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4 text-blue-600"}),"Ideris API"]})})]})})})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("form",{onSubmit:D,className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{ref:g,type:"text",value:w,onChange:t=>h(t.target.value),placeholder:"Bipe ou digite o código...",className:"w-full pl-10 pr-4 py-2 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",disabled:A||!w.trim(),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium shadow-sm hover:shadow transition-all disabled:opacity-70 flex-1 md:flex-none",children:A?e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full"}):"Verificar"}),e.jsx("div",{className:"md:hidden",children:e.jsx("button",{type:"button",onClick:Q,className:`p-2 rounded-lg shadow-sm transition-all ${n?"bg-red-500 text-white animate-pulse":"bg-gray-800 text-white"}`,title:n?"Parar Scanner":"Abrir Scanner",children:n?e.jsx(G,{className:"w-5 h-5"}):e.jsx(X,{className:"w-5 h-5"})})})]})]}),e.jsxs("div",{className:"mt-4 overflow-hidden rounded-xl bg-black",style:{display:n?"block":"none"},children:[e.jsx("div",{id:"verification-reader",className:"w-full"}),e.jsx("p",{className:"text-center text-white py-2 text-sm",children:"Aponte para o código de barras"})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsxs("button",{onClick:_,className:"text-gray-600 hover:bg-gray-100 px-4 py-2 rounded-lg font-medium flex items-center gap-2 transition-colors",children:[e.jsx(U,{className:"w-4 h-4"})," Imprimir Lista"]}),e.jsxs("button",{onClick:H,className:"text-red-600 hover:bg-red-50 px-4 py-2 rounded-lg font-medium flex items-center gap-2 transition-colors",children:[e.jsx(S,{className:"w-4 h-4"})," Limpar Tudo"]})]})]}),m&&e.jsx("div",{className:`rounded-xl shadow-lg border-l-8 p-6 animate-fade-in ${m.type==="success"?"bg-green-50 border-green-500":"bg-red-50 border-red-500"}`,children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-6",children:[e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("p",{className:"text-sm font-bold opacity-60 uppercase mb-1",children:"Última Verificação"}),e.jsx("h2",{className:"text-4xl font-black tracking-tight text-gray-900",children:m.code}),e.jsx("p",{className:`text-2xl font-bold mt-2 ${m.type==="success"?"text-green-700":"text-red-600"}`,children:m.status}),m.customer&&e.jsx("p",{className:"text-gray-600 mt-1 font-medium",children:m.customer})]}),e.jsx("div",{className:"flex items-center gap-4",children:m.type==="success"?e.jsx(T,{className:"w-24 h-24 text-green-500 opacity-20"}):e.jsx(P,{className:"w-24 h-24 text-red-500 opacity-20"})})]})}),d.length>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden print-visible",children:[e.jsx("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50",children:e.jsxs("h3",{className:"font-bold text-gray-700",children:["Histórico (",d.length,")"]})}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full border-separate border-spacing-0",children:[e.jsx("thead",{className:"bg-gray-50 text-xs uppercase text-gray-500 font-bold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left w-20",children:"#"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Hora"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Código"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Cliente"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:d.map((t,s)=>{const r=E[t.code]>1,a=d.length-s;let l="hover:bg-gray-50";t.type==="error"&&(l+=" bg-red-50 hover:bg-red-100");const y=r?"border-l-4 border-red-500":"border-l-4 border-transparent";return e.jsxs("tr",{className:l,children:[e.jsxs("td",{className:`px-6 py-3 text-sm font-bold text-gray-400 w-16 ${y}`,children:["#",a]}),e.jsx("td",{className:"px-6 py-3 text-sm text-gray-500",children:t.timestamp.toLocaleTimeString("pt-BR")}),e.jsx("td",{className:"px-6 py-3 font-bold text-gray-900",children:t.code}),e.jsx("td",{className:"px-6 py-3 text-sm text-gray-600",children:t.customer||"-"}),e.jsx("td",{className:"px-6 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold uppercase ${t.type==="success"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-3 text-right",children:e.jsx("button",{onClick:()=>I(s),className:"text-gray-400 hover:text-red-500 p-2 rounded transition-colors",title:"Remover item",children:e.jsx(S,{className:"w-4 h-4"})})})]},s)})})]})}),e.jsx("div",{className:"md:hidden divide-y divide-gray-200",children:d.map((t,s)=>{const r=E[t.code]>1,a=d.length-s;let l="p-4 transition-colors duration-150 relative";return t.type==="error"?l+=" bg-red-50":l+=" bg-white",r&&(l+=" border-l-4 border-red-500"),e.jsx("div",{className:l,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"text-xs font-bold text-gray-400",children:["#",a]}),e.jsx("span",{className:"text-xs font-mono text-gray-500 bg-gray-100 px-2 py-1 rounded",children:t.timestamp.toLocaleTimeString("pt-BR")}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold uppercase ${t.type==="success"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:t.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold text-gray-900 break-all",children:t.code}),t.customer&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-1",children:t.customer})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-3 ml-4",children:[e.jsx("button",{onClick:()=>I(s),className:"text-gray-400 hover:text-red-500 p-1",children:e.jsx(S,{className:"w-5 h-5"})}),t.type==="success"?e.jsx(T,{className:"w-6 h-6 text-green-500"}):e.jsx(P,{className:"w-6 h-6 text-red-500"})]})]})},s)})})]})]}),e.jsxs("div",{className:"hidden print:block p-8 bg-white text-black bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b-2 border-black pb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold uppercase tracking-wide",children:"Relatório de Conferência"}),e.jsxs("p",{className:"text-lg mt-1",children:[new Date().toLocaleDateString("pt-BR")," - ",new Date().toLocaleTimeString("pt-BR")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Total de Itens"}),e.jsx("p",{className:"text-4xl font-black",children:d.length})]})]}),e.jsxs("table",{className:"w-full text-sm border-collapse mb-8",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-black",children:[e.jsx("th",{className:"text-left py-2 px-3 font-bold uppercase w-16",children:"#"}),e.jsx("th",{className:"text-left py-2 px-3 font-bold uppercase w-32",children:"Hora"}),e.jsx("th",{className:"text-left py-2 px-3 font-bold uppercase",children:"Código"}),e.jsx("th",{className:"text-left py-2 px-3 font-bold uppercase w-40",children:"Status"})]})}),e.jsx("tbody",{children:[...d].reverse().map((t,s)=>e.jsxs("tr",{className:`border-b border-gray-300 ${s%2===0?"bg-gray-100":"bg-white"}`,children:[e.jsx("td",{className:"py-3 px-3 text-gray-700",children:s+1}),e.jsx("td",{className:"py-3 px-3 font-mono",children:t.timestamp.toLocaleTimeString("pt-BR")}),e.jsx("td",{className:"py-3 px-3 font-bold text-lg",children:t.code}),e.jsx("td",{className:"py-3 px-3 uppercase font-medium",children:t.status})]},s))})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center mt-20 pt-10",children:[e.jsx("div",{className:"w-96 border-b-2 border-black mb-3"}),e.jsx("p",{className:"text-sm uppercase font-bold tracking-wider",children:"Assinatura do Responsável"})]})]})]})}export{le as default};
