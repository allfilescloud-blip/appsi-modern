import{r as t,u as K,q as Q,m as U,k as W,o as Y,j as e,a as z,d as Z,g as ee}from"./index-BIQNIXWJ.js";import{T as se}from"./ticket-D2wMWNck.js";import{P as te}from"./plus-BZ7uuc_C.js";import{S as ae}from"./search-CUfjDCWZ.js";import{X as re}from"./x-BWAmgk43.js";import{c as H}from"./createLucideIcon-BiC_M7d7.js";import{A as O}from"./alert-triangle-DYeiMHlu.js";import{P as q}from"./paperclip-P5hiYjOS.js";import{E as oe}from"./eye-DM5jHwgZ.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=H("FilterX",[["path",{d:"M13.013 3H2l8 9.46V19l4 2v-8.54l.9-1.055",key:"1fi1da"}],["path",{d:"m22 3-5 5",key:"12jva0"}],["path",{d:"m17 3 5 5",key:"k36vhe"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=H("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),X=o=>{if(!o)return"-";try{const[p,h,g]=o.split("-");return`${g}/${h}/${p}`}catch{return o}};function fe(){const[o,p]=t.useState([]),[h,g]=t.useState(!0),[l,w]=t.useState(localStorage.getItem("ticketSearchTerm")||""),[c,C]=t.useState(localStorage.getItem("ticketStatusFilter")||"Todos"),f=K(),m=t.useRef(null);t.useEffect(()=>{m.current&&m.current.focus()},[]),t.useEffect(()=>{const s=Q(W(z,"chamados"),U("dataAbertura","desc")),a=Y(s,r=>{const n=r.docs.map(u=>({id:u.id,...u.data()}));p(n),g(!1)},r=>{console.error("Erro ao buscar chamados:",r),r.code==="permission-denied"&&g(!1)});return()=>a()},[]);const[V,R]=t.useState([]),[_,F]=t.useState([]);t.useEffect(()=>{(async()=>{try{const a=Z(z,"sys_settings","general"),r=await ee(a);if(r.exists()){const n=r.data();R(n.ticketTypes||[]),F(n.marketplaces||[])}else R(["Devolução","Reembolso","Fraude","Contatar MarketPlace","Contatar Cliente","Interno","Defeito","Prejuízo","Atraso na entrega","Produto errado","Faltou item","Dúvida técnica","Cancelamento"]),F(["Mercado Livre","Amazon","Interno","Shopee","Magalu"])}catch(a){console.error("Error fetching settings:",a)}})()},[]);const[d,A]=t.useState(localStorage.getItem("ticketTypeFilter")||"Todos"),[i,P]=t.useState(localStorage.getItem("ticketMarketplaceFilter")||"Todos"),[x,D]=t.useState(localStorage.getItem("ticketResponsibleFilter")||"Todos");t.useEffect(()=>{localStorage.setItem("ticketSearchTerm",l)},[l]),t.useEffect(()=>{localStorage.setItem("ticketStatusFilter",c)},[c]),t.useEffect(()=>{localStorage.setItem("ticketTypeFilter",d)},[d]),t.useEffect(()=>{localStorage.setItem("ticketMarketplaceFilter",i)},[i]),t.useEffect(()=>{localStorage.setItem("ticketResponsibleFilter",x)},[x]);const G=()=>{w(""),C("Todos"),A("Todos"),P("Todos"),D("Todos")},J=()=>{w(""),m.current&&(m.current.blur(),setTimeout(()=>{var s;(s=m.current)==null||s.focus()},50))},E=o.filter(s=>{var I,M,$,B;const a=((I=s.codigo)==null?void 0:I.toLowerCase().includes(l.toLowerCase()))||((M=s.assunto)==null?void 0:M.toLowerCase().includes(l.toLowerCase()))||(($=s.responsavel)==null?void 0:$.toLowerCase().includes(l.toLowerCase()))||((B=s.pedido)==null?void 0:B.toLowerCase().includes(l.toLowerCase())),r=c==="Todos"||s.status===c,n=d==="Todos"||s.tipo===d,u=i==="Todos"||s.marketplace===i,N=x==="Todos"||s.responsavel===x;return a&&r&&n&&u&&N}),L=s=>{switch(s){case"Aberto":return"bg-blue-100 text-blue-800";case"Pendente":return"bg-yellow-100 text-yellow-800";case"Revisão":return"bg-purple-100 text-purple-800";case"Fechado":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},b=s=>{if(!s)return!1;try{const[a,r,n]=s.split("-").map(Number),u=new Date(a,r-1,n),N=new Date;return N.setHours(0,0,0,0),u<N}catch{return!1}},T=50,[y,S]=t.useState(1);t.useEffect(()=>{S(1)},[l,c,d,i,x]);const j=Math.ceil(E.length/T),k=(y-1)*T,v=E.slice(k,k+T);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(se,{className:"w-8 h-8 text-blue-600"}),"Chamados"]}),e.jsxs("div",{className:"flex gap-4 mt-1 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})," Abertos: ",o.filter(s=>s.status==="Aberto").length]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-yellow-500"})," Pendentes: ",o.filter(s=>s.status==="Pendente").length]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500"})," Em Revisão: ",o.filter(s=>s.status==="Revisão").length]})]})]}),e.jsxs("button",{onClick:()=>f("/chamados/novo"),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors",children:[e.jsx(te,{className:"w-5 h-5"}),"Novo Chamado"]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"relative h-10",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5 pointer-events-none"}),e.jsx("input",{ref:m,type:"text",placeholder:"Buscar por código, assunto ou responsável...",value:l,onChange:s=>w(s.target.value),className:"w-full h-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-sm"}),l&&e.jsx("button",{onClick:J,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 p-1 flex items-center justify-center h-8 w-8",children:e.jsx(re,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-2 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full md:w-auto",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 md:hidden",children:"Filtros"}),e.jsx("div",{className:"flex items-center justify-center w-8 h-8 flex-shrink-0 mr-1 md:mr-0",children:c!=="Todos"||d!=="Todos"||i!=="Todos"||x!=="Todos"?e.jsx("button",{onClick:G,className:"text-red-500 hover:text-red-700 transition-colors flex items-center justify-center w-full h-full",title:"Limpar todos os filtros",children:e.jsx(le,{className:"w-5 h-5"})}):e.jsx("div",{className:"text-gray-500 flex items-center justify-center w-full h-full",title:"Filtrar chamados",children:e.jsx(ne,{className:"w-5 h-5"})})})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:flex sm:flex-wrap lg:flex-nowrap items-center gap-2 w-full",children:[e.jsxs("select",{value:c,onChange:s=>C(s.target.value),className:"w-full border border-gray-300 rounded-lg px-2 py-2 focus:ring-2 focus:ring-blue-500 outline-none text-sm",children:[e.jsx("option",{value:"Todos",children:"Todos os Status"}),e.jsx("option",{value:"Aberto",children:"Aberto"}),e.jsx("option",{value:"Pendente",children:"Pendente"}),e.jsx("option",{value:"Revisão",children:"Revisão"}),e.jsx("option",{value:"Fechado",children:"Fechado"})]}),e.jsxs("select",{value:d,onChange:s=>A(s.target.value),className:"w-full border border-gray-300 rounded-lg px-2 py-2 focus:ring-2 focus:ring-blue-500 outline-none text-sm",children:[e.jsx("option",{value:"Todos",children:"Todos os Tipos"}),V.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:i,onChange:s=>P(s.target.value),className:"w-full border border-gray-300 rounded-lg px-2 py-2 focus:ring-2 focus:ring-blue-500 outline-none text-sm",children:[e.jsx("option",{value:"Todos",children:"Todos os Marketplaces"}),_.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:x,onChange:s=>D(s.target.value),className:"w-full border border-gray-300 rounded-lg px-2 py-2 focus:ring-2 focus:ring-blue-500 outline-none text-sm",children:[e.jsx("option",{value:"Todos",children:"Todos os Responsáveis"}),[...new Set(o.map(s=>s.responsavel).filter(Boolean))].sort().map(s=>e.jsx("option",{value:s,children:s},s))]})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100 border-b-2 border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider border-r border-white",children:"Código"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider border-r border-white",children:"Assunto"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider border-r border-white",children:"Retorno"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider border-r border-white",children:"Responsável"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider border-r border-white",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider border-r border-white",children:"Data"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:h?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-10 text-center text-gray-500",children:e.jsxs("div",{className:"flex justify-center items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),"Carregando chamados..."]})})}):v.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-10 text-center text-gray-500",children:"Nenhum chamado encontrado."})}):v.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>f(`/chamados/${s.id}`),children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap font-medium text-blue-600",children:s.codigo}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900 font-medium",children:s.assunto}),e.jsx("div",{className:"text-xs text-gray-500",children:s.tipo})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.dataRetorno?e.jsx("span",{className:`text-xs ${b(s.dataRetorno)?"text-red-600 font-bold":"text-gray-700 font-medium"}`,children:X(s.dataRetorno)}):e.jsx("span",{className:"text-xs text-gray-400",children:"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold text-gray-600",children:s.responsavel?s.responsavel.charAt(0):"?"}),e.jsx("span",{className:"text-sm text-gray-700",children:s.responsavel||"Não atribuído"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${L(s.status)}`,children:s.status})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-xs text-gray-900 font-medium",children:new Date(s.dataAbertura).toLocaleDateString("pt-BR")}),s.dataAtualizacao&&e.jsxs("div",{className:"text-[10px] text-gray-400 mt-1 uppercase tracking-tighter",children:["Alt: ",new Date(s.dataAtualizacao).toLocaleDateString("pt-BR")]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[b(s.dataRetorno)&&e.jsx("div",{className:"text-red-500 animate-pulse",title:"Atenção: Data de retorno expirou",children:e.jsx(O,{className:"w-5 h-5"})}),s.anexos&&s.anexos.length>0&&e.jsx(q,{className:"w-4 h-4 text-gray-400",title:"Possui anexos"}),e.jsx("button",{onClick:a=>{a.stopPropagation(),f(`/chamados/${s.id}`)},className:"text-blue-600 hover:text-blue-900",title:"Ver Detalhes",children:e.jsx(oe,{className:"w-5 h-5"})})]})})]},s.id))})]})}),e.jsx("div",{className:"md:hidden",children:h?e.jsx("div",{className:"p-10 text-center text-gray-500",children:e.jsxs("div",{className:"flex justify-center items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),"Carregando chamados..."]})}):v.length===0?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Nenhum chamado encontrado."}):e.jsx("div",{className:"divide-y divide-gray-200",children:v.map(s=>e.jsxs("div",{className:"p-4 hover:bg-gray-50 active:bg-gray-100 cursor-pointer",onClick:()=>f(`/chamados/${s.id}`),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-blue-600 text-sm block",children:s.codigo}),e.jsxs("h3",{className:"text-gray-900 font-medium flex items-center gap-2",children:[s.assunto,b(s.dataRetorno)&&e.jsx("div",{className:"text-red-500 animate-pulse",title:"Atenção: Data de retorno expirou",children:e.jsx(O,{className:"w-4 h-4"})}),s.anexos&&s.anexos.length>0&&e.jsx(q,{className:"w-4 h-4 text-gray-400"})]})]}),e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${L(s.status)}`,children:s.status})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-500 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold text-gray-600",children:s.responsavel?s.responsavel.charAt(0):"?"}),e.jsx("span",{children:s.responsavel||"Não atribuído"})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-xs",children:new Date(s.dataAbertura).toLocaleDateString("pt-BR")}),s.dataRetorno&&e.jsxs("span",{className:`text-xs font-bold mt-1 ${b(s.dataRetorno)?"text-red-600":"text-blue-600"}`,children:["Ret: ",X(s.dataRetorno)]})]})]})]},s.id))})}),j>1&&e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 flex items-center justify-between sm:justify-end gap-4 rounded-b-xl",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:["Página ",e.jsx("span",{className:"font-semibold",children:y})," de ",e.jsx("span",{className:"font-semibold",children:j})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>S(s=>Math.max(1,s-1)),disabled:y===1,className:"px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Anterior"}),e.jsx("button",{onClick:()=>S(s=>Math.min(j,s+1)),disabled:y===j,className:"px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Próxima"})]})]})]})]})}export{fe as default};
