import{r as n,j as e,Q as x}from"./index-fdxPoZT0.js";import{g as J}from"./ideris-SjOkkJh4.js";import{S as K,R as Y,P as Z,H as z}from"./html5-qrcode-scanner-tySq_n2m.js";import{C as R}from"./check-circle-C_ovmDjK.js";import{c as A}from"./createLucideIcon-CsBz9SFX.js";import{S as ee}from"./search-CSh1fg9v.js";import{S as te}from"./scan-barcode-CtOJurB2.js";import{T as S}from"./trash-2-Dp4ZJ3Vj.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=A("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=A("WifiOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 4.17-2.65",key:"11utq1"}],["path",{d:"M10.66 5c4.01-.36 8.14.9 11.34 3.76",key:"hxefdu"}],["path",{d:"M16.85 11.25a10 10 0 0 1 2.22 1.68",key:"q734kn"}],["path",{d:"M5 13a10 10 0 0 1 5.24-2.76",key:"piq4yl"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=A("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);function xe(){const[v,y]=n.useState(""),[I,L]=n.useState(!1),[C,O]=n.useState(!1),[l,f]=n.useState([]),[u,j]=n.useState(null),[m,h]=n.useState(!1),[b,F]=n.useState([]),[E,G]=n.useState(null);n.useRef(null);const i=n.useRef(null),N=n.useRef(null),k=n.useRef(!1),D=n.useRef(l);n.useEffect(()=>{D.current=l},[l]),n.useEffect(()=>{var t;return m||(t=N.current)==null||t.focus(),()=>{}},[m]),n.useEffect(()=>()=>{i.current&&(i.current.stop().catch(t=>console.error("Error stopping scanner:",t)),i.current=null)},[]);const g=t=>{const r=new(window.AudioContext||window.webkitAudioContext),s=r.createOscillator(),a=r.createGain();s.connect(a),a.connect(r.destination),t==="success"?(s.type="sine",s.frequency.setValueAtTime(800,r.currentTime),s.frequency.exponentialRampToValueAtTime(1200,r.currentTime+.1),a.gain.setValueAtTime(.1,r.currentTime),a.gain.exponentialRampToValueAtTime(.01,r.currentTime+.1),s.start(),s.stop(r.currentTime+.1)):t==="error"&&(s.type="sawtooth",s.frequency.setValueAtTime(200,r.currentTime),s.frequency.linearRampToValueAtTime(100,r.currentTime+.2),a.gain.setValueAtTime(.2,r.currentTime),a.gain.exponentialRampToValueAtTime(.01,r.currentTime+.2),s.start(),s.stop(r.currentTime+.2))},V=async(t,r=null)=>{var o,p,q;t&&t.preventDefault();const s=r||v.trim();if(!s)return"empty";if(D.current.some(c=>c.code===s)){const c={code:s,status:"DUPLICADO",type:"error",timestamp:new Date,img:null};return j(c),f(d=>[c,...d]),x.warn(`Código ${s} já foi verificado!`),g("error"),y(""),"duplicate"}if(C){const c={code:s,status:"Conferido",type:"success",timestamp:new Date,img:null};return j(c),f(d=>[c,...d]),x.success(`Código ${s} conferido.`),g("success"),y(""),"success"}L(!0);try{const c=await J(s),d=c.statusDescription||c.status||"Encontrado",w=d.toLowerCase().includes("cancelado")||d.toLowerCase().includes("erro"),B={code:s,status:d,type:w?"error":"success",timestamp:new Date,customer:(o=c.customer)==null?void 0:o.name,img:(q=(p=c.items)==null?void 0:p[0])==null?void 0:q.image};return j(B),f(_=>[B,..._]),w?(x.error(`Pedido ${s}: ${d}`),g("error"),"error"):(x.success(`Pedido ${s} verificado!`),g("success"),"success")}catch(c){const d={code:s,status:"Não encontrado / Erro",type:"error",timestamp:new Date,img:null};return j(d),f(w=>[d,...w]),x.error(c.message),g("error"),"error"}finally{L(!1),y(""),m||setTimeout(()=>{var c;(c=N.current)==null||c.focus()},100)}},$=t=>{window.confirm("Remover este item da lista?")&&(f(r=>r.filter((s,a)=>a!==t)),x.info("Item removido."))},Q=()=>{var t;window.confirm("Tem certeza que deseja limpar todo o histórico de verificação?")&&(f([]),j(null),y(""),x.info("Histórico limpo."),(t=N.current)==null||t.focus())},M=async()=>{if(m&&T(),h(!0),await new Promise(r=>setTimeout(r,400)),!document.getElementById("reader-verification")){console.error("Reader element not found"),h(!1);return}try{const r=await z.getCameras();F(r);const s=new z("reader-verification");i.current=s;const a={fps:20,qrbox:{width:300,height:300},aspectRatio:1},o=E||{facingMode:"environment"};await s.start(o,a,async p=>{if(!k.current){k.current=!0,g("success");try{await V(null,p)}finally{setTimeout(()=>{k.current=!1},1500)}}},p=>{})}catch(r){console.error("Erro ao iniciar scanner:",r),x.error("Não foi possível acessar a câmera."),h(!1)}},W=async()=>{if(!i.current||b.length<2)return;const r=(b.findIndex(a=>a.id===E)+1)%b.length,s=b[r].id;try{T(),G(s),setTimeout(()=>M(),100),x.info(`Câmera alterada para: ${b[r].label||"Próxima"}`)}catch(a){console.error("Erro ao trocar câmera:",a),x.error("Erro ao trocar de câmera.")}},T=()=>{i.current?i.current.stop().then(()=>{i.current=null,h(!1)}).catch(t=>{console.error("Erro ao parar scanner:",t),h(!1)}):h(!1)};n.useEffect(()=>()=>{i.current&&(i.current.stop().catch(t=>console.error(t)),i.current=null)},[]);const X=()=>{m?T():M()},U=()=>{window.print()},P=l.reduce((t,r)=>(t[r.code]=(t[r.code]||0)+1,t),{});return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 pb-20",children:[e.jsxs("div",{className:"print:hidden space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 bg-white p-4 rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(R,{className:"w-8 h-8 text-blue-600"}),"Verificação"]}),e.jsx("div",{className:"flex items-center gap-4 bg-gray-50 px-4 py-2 rounded-lg border border-gray-200",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:!C,onChange:t=>O(!t.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"}),e.jsx("span",{className:"ml-3 text-sm font-bold text-gray-700 flex items-center gap-2",children:C?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-4 h-4 text-gray-500"}),"Modo Local"]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4 text-blue-600"}),"Ideris API"]})})]})})})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("form",{onSubmit:V,className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{ref:N,type:"text",value:v,onChange:t=>y(t.target.value),placeholder:"Bipe ou digite o código...",className:"w-full pl-10 pr-4 py-2 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",disabled:I||!v.trim(),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium shadow-sm hover:shadow transition-all disabled:opacity-70 flex-1 md:flex-none",children:I?e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full"}):"Verificar"}),e.jsx("button",{type:"button",onClick:X,className:`p-3 rounded-lg border transition-colors ${m?"bg-red-50 border-red-200 text-red-600 animate-pulse":"bg-white border-gray-300 text-gray-600 hover:bg-gray-50"}`,title:m?"Parar Scanner":"Abrir Câmera",children:m?e.jsx(K,{size:20}):e.jsx(te,{size:20})}),m&&b.length>1&&e.jsx("button",{type:"button",onClick:W,className:"p-3 rounded-lg border bg-blue-50 border-blue-200 text-blue-600 hover:bg-blue-100 transition-colors",title:"Alternar Câmera",children:e.jsx(Y,{size:20})})]})]}),m&&e.jsxs("div",{className:"mt-4 overflow-hidden rounded-xl bg-black relative",style:{minHeight:"300px"},children:[e.jsx("div",{id:"reader-verification",className:"w-full h-full"}),e.jsx("p",{className:"text-center text-white py-2 text-sm bg-black font-semibold absolute bottom-0 left-0 w-full opacity-70 border-t border-white/20",children:"Escaneando..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsxs("button",{onClick:U,className:"text-gray-600 hover:bg-gray-100 px-4 py-2 rounded-lg font-medium flex items-center gap-2 transition-colors",children:[e.jsx(Z,{className:"w-4 h-4"})," Imprimir Lista"]}),e.jsxs("button",{onClick:Q,className:"text-red-600 hover:bg-red-50 px-4 py-2 rounded-lg font-medium flex items-center gap-2 transition-colors",children:[e.jsx(S,{className:"w-4 h-4"})," Limpar Tudo"]})]})]}),u&&e.jsx("div",{className:`rounded-xl shadow-lg border-l-8 p-6 animate-fade-in ${u.type==="success"?"bg-green-50 border-green-500":"bg-red-50 border-red-500"}`,children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-6",children:[e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("p",{className:"text-sm font-bold opacity-60 uppercase mb-1",children:"Última Verificação"}),e.jsx("h2",{className:"text-4xl font-black tracking-tight text-gray-900",children:u.code}),e.jsx("p",{className:`text-2xl font-bold mt-2 ${u.type==="success"?"text-green-700":"text-red-600"}`,children:u.status}),u.customer&&e.jsx("p",{className:"text-gray-600 mt-1 font-medium",children:u.customer})]}),e.jsx("div",{className:"flex items-center gap-4",children:u.type==="success"?e.jsx(R,{className:"w-24 h-24 text-green-500 opacity-20"}):e.jsx(H,{className:"w-24 h-24 text-red-500 opacity-20"})})]})}),l.length>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden print-visible",children:[e.jsx("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50",children:e.jsxs("h3",{className:"font-bold text-gray-700",children:["Histórico (",l.length,")"]})}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full border-separate border-spacing-0",children:[e.jsx("thead",{className:"bg-gray-50 text-xs uppercase text-gray-500 font-bold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left w-20",children:"#"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Hora"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Código"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Cliente"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:l.map((t,r)=>{const s=P[t.code]>1,a=l.length-r;let o="hover:bg-gray-50";t.type==="error"&&(o+=" bg-red-50 hover:bg-red-100");const p=s?"border-l-4 border-red-500":"border-l-4 border-transparent";return e.jsxs("tr",{className:o,children:[e.jsxs("td",{className:`px-6 py-3 text-sm font-bold text-gray-400 w-16 ${p}`,children:["#",a]}),e.jsx("td",{className:"px-6 py-3 text-sm text-gray-500",children:t.timestamp.toLocaleTimeString("pt-BR")}),e.jsx("td",{className:"px-6 py-3 font-bold text-gray-900",children:t.code}),e.jsx("td",{className:"px-6 py-3 text-sm text-gray-600",children:t.customer||"-"}),e.jsx("td",{className:"px-6 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold uppercase ${t.type==="success"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-3 text-right",children:e.jsx("button",{onClick:()=>$(r),className:"text-gray-400 hover:text-red-500 p-2 rounded transition-colors",title:"Remover item",children:e.jsx(S,{className:"w-4 h-4"})})})]},r)})})]})}),e.jsx("div",{className:"md:hidden divide-y divide-gray-200",children:l.map((t,r)=>{const s=P[t.code]>1,a=l.length-r;let o="p-4 transition-colors duration-150 relative";return t.type==="error"?o+=" bg-red-50":o+=" bg-white",s&&(o+=" border-l-4 border-red-500"),e.jsx("div",{className:o,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"text-xs font-bold text-gray-400",children:["#",a]}),e.jsx("span",{className:"text-xs font-mono text-gray-500 bg-gray-100 px-2 py-1 rounded",children:t.timestamp.toLocaleTimeString("pt-BR")}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold uppercase ${t.type==="success"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:t.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold text-gray-900 break-all",children:t.code}),t.customer&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-1",children:t.customer})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-3 ml-4",children:[e.jsx("button",{onClick:()=>$(r),className:"text-gray-400 hover:text-red-500 p-1",children:e.jsx(S,{className:"w-5 h-5"})}),t.type==="success"?e.jsx(R,{className:"w-6 h-6 text-green-500"}):e.jsx(H,{className:"w-6 h-6 text-red-500"})]})]})},r)})})]})]}),e.jsxs("div",{className:"hidden print:block p-8 bg-white text-black bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b-2 border-black pb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold uppercase tracking-wide",children:"Relatório de Conferência"}),e.jsxs("p",{className:"text-lg mt-1",children:[new Date().toLocaleDateString("pt-BR")," - ",new Date().toLocaleTimeString("pt-BR")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Total de Itens"}),e.jsx("p",{className:"text-4xl font-black",children:l.length})]})]}),e.jsxs("table",{className:"w-full text-sm border-collapse mb-8",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-black",children:[e.jsx("th",{className:"text-left py-2 px-3 font-bold uppercase w-16",children:"#"}),e.jsx("th",{className:"text-left py-2 px-3 font-bold uppercase w-32",children:"Hora"}),e.jsx("th",{className:"text-left py-2 px-3 font-bold uppercase",children:"Código"}),e.jsx("th",{className:"text-left py-2 px-3 font-bold uppercase w-40",children:"Status"})]})}),e.jsx("tbody",{children:[...l].reverse().map((t,r)=>e.jsxs("tr",{className:`border-b border-gray-300 ${r%2===0?"bg-gray-100":"bg-white"}`,children:[e.jsx("td",{className:"py-3 px-3 text-gray-700",children:r+1}),e.jsx("td",{className:"py-3 px-3 font-mono",children:t.timestamp.toLocaleTimeString("pt-BR")}),e.jsx("td",{className:"py-3 px-3 font-bold text-lg",children:t.code}),e.jsx("td",{className:"py-3 px-3 uppercase font-medium",children:t.status})]},r))})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center mt-20 pt-10",children:[e.jsx("div",{className:"w-96 border-b-2 border-black mb-3"}),e.jsx("p",{className:"text-sm uppercase font-bold tracking-wider",children:"Assinatura do Responsável"})]})]})]})}export{xe as default};
